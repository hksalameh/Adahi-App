rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /sacrifices/{sacrificeId} {
      // الإنشاء: يسمح فقط للمستخدمين المسجلين، ويجب أن يتضمن userId الخاص بهم
      allow create: if request.auth != null && 
                       request.resource.data.userId == request.auth.uid &&
                       request.resource.data.status == 'pending_approval';

      // القراءة: المسؤول فقط يمكنه قراءة جميع المستندات
      allow read: if request.auth != null && request.auth.uid == "AKpJLStGGnRC2Albb8bpZ0KtTGq1"; 

      // التحديث: المسؤول فقط يمكنه تحديث حقل status (أو أي حقول أخرى إذا عدلت القاعدة)
      allow update: if request.auth != null && 
                       request.auth.uid == "AKpJLStGGnRC2Albb8bpZ0KtTGq1" &&
                       request.resource.data.diff(request.resource.data).affectedKeys().hasOnly(['status']);
                       // لللسماح بتحديث كل شيء للمسؤول:
                       // request.auth.uid == "AKpJLStGGnRC2Albb8bpZ0KtTGq1";

      // الحذف: لا يسمح به من التطبيق مبدئيًا
      allow delete: if false;
                  // للسماح للمسؤول بالحذف:
                  // request.auth != null && request.auth.uid == "AKpJLStGGnRC2Albb8bpZ0KtTGq1";
    }
  }
}
